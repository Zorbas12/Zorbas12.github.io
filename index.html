<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Submissions</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<style>
  .acceptBtn { background-color: #4CAF50; color: white; border: none; cursor: pointer; padding: 5px; }
  .declineBtn { background-color: #f44336; color: white; border: none; cursor: pointer; padding: 5px; }
  .store-button { margin: 2px; cursor: pointer; }
  #submissionsList div, #storeSubmissionsList div { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
</style>
</head>
<body>

<div id="mainFormSection"> ... </div>
<div id="adminGuiSection"> ... </div>
<div id="storeMenuSection"> ... </div>
<div id="storeSubmissionsSection"> ... </div>
<div id="noPermissionSection"> ... </div>

<script>
// -------------------- Firebase Init --------------------
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// -------------------- Existing Variables --------------------
const deviceId = localStorage.getItem('deviceId') || Date.now().toString();
localStorage.setItem('deviceId', deviceId);

const SUPER_ADMIN_ID = "1234567890"; // replace
const admins = ["1111","2222"];
const allowedUsers = ["1111","2222","3333"];

const currentLang = 'english';
const translations = { english:{acceptBtn:"Accept",declineBtn:"Decline"}, greek:{acceptBtn:"Αποδοχή",declineBtn:"Απόρριψη"} };

const mainFormSection = document.getElementById('mainFormSection');
const adminGuiSection = document.getElementById('adminGuiSection');
const submissionsGuiSection = document.getElementById('submissionsList');
const storeMenuSection = document.getElementById('storeMenuSection');
const storeSubmissionsSection = document.getElementById('storeSubmissionsSection');
const noPermissionSection = document.getElementById('noPermissionSection');
const adminButtonsDiv = document.getElementById('adminButtonsDiv');
const storeButtonsDiv = document.getElementById('storeButtonsDiv');
const storeSubmissionsList = document.getElementById('storeSubmissionsList');
const storeTitle = document.getElementById('storeTitle');

let pendingSubmissions = [];

// -------------------- Real-time listener --------------------
db.ref('pendingSubmissions').on('value', snapshot => {
  pendingSubmissions = snapshot.val() || [];
  renderSubmissions();
});

// -------------------- Render Submissions --------------------
function renderSubmissions(){
  const container=document.getElementById('submissionsList');
  container.innerHTML='';
  pendingSubmissions.forEach((sub,index)=>{
    const subDiv=document.createElement('div');
    const makeBoldLabel=(label,value)=>{
      const p=document.createElement('p');
      p.innerHTML=`<strong>${label}:</strong> ${value}`;
      p.style.fontSize='16px';
      return p;
    };
    const nameP=makeBoldLabel(currentLang==='greek'?'Όνομα':'Name',sub.name);
    const monthP=makeBoldLabel(currentLang==='greek'?'Μήνας':'Month',sub.month);
    const dayP=makeBoldLabel(currentLang==='greek'?'Ημέρα':'Day',sub.day);
    const shiftP=makeBoldLabel(currentLang==='greek'?'Βάρδια':'Shift',sub.shift);
    const storeP=makeBoldLabel(currentLang==='greek'?'Κατάστημα':'Store',sub.store);
    const btnContainer=document.createElement('div');
    btnContainer.style.display='flex';
    btnContainer.style.gap='10px';
    const acceptBtn=document.createElement('button');
    acceptBtn.innerText=translations[currentLang].acceptBtn;
    acceptBtn.className='acceptBtn';
    acceptBtn.style.flex='1';
    acceptBtn.onclick=()=>{
      const updated = [...pendingSubmissions];
      updated.splice(index,1);
      db.ref('pendingSubmissions').set(updated);
    };
    const declineBtn=document.createElement('button');
    declineBtn.innerText=translations[currentLang].declineBtn;
    declineBtn.className='declineBtn';
    declineBtn.style.flex='1';
    declineBtn.onclick=()=>{
      const updated = [...pendingSubmissions];
      updated.splice(index,1);
      db.ref('pendingSubmissions').set(updated);
    };
    btnContainer.appendChild(acceptBtn);
    btnContainer.appendChild(declineBtn);
    subDiv.appendChild(nameP);
    subDiv.appendChild(monthP);
    subDiv.appendChild(dayP);
    subDiv.appendChild(shiftP);
    subDiv.appendChild(storeP);
    subDiv.appendChild(btnContainer);
    container.appendChild(subDiv);
  });
}

// -------------------- Admin & Permissions --------------------
function updateAdminButtonsVisibility(){
  const isAdmin = admins.includes(deviceId.toString()) || deviceId.toString() === SUPER_ADMIN_ID.toString();
  adminButtonsDiv.style.display = (isAdmin || mainFormSection.style.display !== 'none') ? 'flex' : 'none';
}

function checkPermission(){
  if(!allowedUsers.includes(deviceId.toString()) && deviceId.toString() !== SUPER_ADMIN_ID.toString()){
    showSection(noPermissionSection);
  } else {
    showSection(mainFormSection);
    updateAdminButtonsVisibility();
  }
}

function showSection(section){
  mainFormSection.style.display='none';
  adminGuiSection.style.display='none';
  submissionsGuiSection.style.display='none';
  noPermissionSection.style.display='none';
  storeMenuSection.style.display='none';
  storeSubmissionsSection.style.display='none';
  section.style.display='flex';
  updateAdminButtonsVisibility();
}

checkPermission();

// -------------------- Buttons Logic --------------------
document.getElementById('adminGuiBtn').addEventListener('click',()=>showSection(adminGuiSection));

document.getElementById('seeAllBtn').addEventListener('click',()=>{
  storeButtonsDiv.innerHTML='';
  for(let i=65;i<=90;i++){
    const letter=String.fromCharCode(i);
    const btn=document.createElement('button');
    btn.className='store-button';
    btn.innerText=letter;
    btn.onclick=()=>{
      storeSubmissionsList.innerHTML='';
      storeTitle.innerText=`Store ${letter}`;
      pendingSubmissions.filter(s=>s.store===letter).forEach((sub,index)=>{
        const subDiv=document.createElement('div');
        const makeBoldLabel=(label,value)=>{
          const p=document.createElement('p');
          p.innerHTML=`<strong>${label}:</strong> ${value}`;
          p.style.fontSize='16px';
          return p;
        };
        const nameP=makeBoldLabel(currentLang==='greek'?'Όνομα':'Name',sub.name);
        const monthP=makeBoldLabel(currentLang==='greek'?'Μήνας':'Month',sub.month);
        const dayP=makeBoldLabel(currentLang==='greek'?'Ημέρα':'Day',sub.day);
        const shiftP=makeBoldLabel(currentLang==='greek'?'Βάρδια':'Shift',sub.shift);
        const storeP=makeBoldLabel(currentLang==='greek'?'Κατάστημα':'Store',sub.store);
        const btnContainer=document.createElement('div');
        btnContainer.style.display='flex';
        btnContainer.style.gap='10px';
        const acceptBtn=document.createElement('button');
        acceptBtn.innerText=translations[currentLang].acceptBtn;
        acceptBtn.style.flex='1';
        acceptBtn.onclick=()=>{
          const updated = pendingSubmissions.filter(s=>s!==sub);
          db.ref('pendingSubmissions').set(updated);
          btn.click();
        };
        const declineBtn=document.createElement('button');
        declineBtn.innerText=translations[currentLang].declineBtn;
        declineBtn.style.flex='1';
        declineBtn.onclick=()=>{
          const updated = pendingSubmissions.filter(s=>s!==sub);
          db.ref('pendingSubmissions').set(updated);
          btn.click();
        };
        btnContainer.appendChild(acceptBtn);
        btnContainer.appendChild(declineBtn);
        subDiv.appendChild(nameP);
        subDiv.appendChild(monthP);
        subDiv.appendChild(dayP);
        subDiv.appendChild(shiftP);
        subDiv.appendChild(storeP);
        subDiv.appendChild(btnContainer);
        storeSubmissionsList.appendChild(subDiv);
      });
      showSection(storeSubmissionsSection);
    };
    storeButtonsDiv.appendChild(btn);
  }
  showSection(storeMenuSection);
});

document.getElementById('resetAllBtn').addEventListener('click',()=>{
  db.ref('pendingSubmissions').remove();
});

document.getElementById('backBtn').addEventListener('click',()=>showSection(mainFormSection));
document.getElementById('backFromSubmissionsBtn').addEventListener('click',()=>showSection(adminGuiSection));
document.getElementById('backFromStoreMenuBtn').addEventListener('click',()=>showSection(adminGuiSection));
document.getElementById('backFromStoreSubmissionsBtn').addEventListener('click',()=>showSection(storeMenuSection));

</script>
</body>
</html>
